<!DOCTYPE html>
<html ng-app="myApp">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Smart Health</title>
    <link rel="stylesheet" href="assets/css/bootstrap.css">
    <link rel="stylesheet" href="assets/css/bootstrap-grid.css">
    <link rel="stylesheet" href="assets/css/bootstrap-reboot.css">
    <link rel="stylesheet" href="assets/css/sb-admin-2.css">
    <script src="assets/js/jquery-3.3.1.min.js"></script>
    <script src="assets/js/angular.js"></script>
    <script src="assets/js/angular-animate.js"></script>
    <script src="assets/js/bootstrap.bundle.js"></script>
    <script src="assets/js/angular-route.min.js"></script>
    <script src="assets/js/bootstrap.js"></script>
    <script src="assets/js/Chart.min.js"></script>
    <script src="assets/js/Chart.bundle.min.js"></script>
    <script src="assets/js/mqttws31.min.js"></script>
    <script src="config.js"></script>
<script>
    function update(chart, label, data) {
        chart.data.datasets[label].data.push(data);
        chart.update();
    }

    let mqtt = new Paho.MQTT.Client("127.0.0.1",1884,"IOT-ESP");
    mqtt.onMessageArrived = function (data) {
        console.log(data.destinationName);

        const object = data.payloadString;
        console.log(object);

        try {
            update(myLineChart,0,90);
        }
        catch(err) {
            console.log(err.message);
        }
        try {
            update(myLineChart,1,70);
        }
        catch(err) {
            console.log(err.message);
        }
    };
    mqtt.connect(
        {
            onSuccess: function () {
                mqtt.subscribe("IOT-ESP");
            }
        }
    );

    //Adding button handling
    function sendMessage(value) {
        let message;
        switch(value) {
            case 0:
                message = new Paho.MQTT.Message("0");
                break;
            case 1:
                message = new Paho.MQTT.Message("1");
                break;
            case 2:
                message = new Paho.MQTT.Message("2");
                break;
            default:
                message = new Paho.MQTT.Message("0");
        }
        message.destinationName = "WEB-ESP";
        mqtt.send(message);
    }

</script>
</head>
<body id="page-top">
<div ng-controller="MultiController" id="wrapper">
    <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">
        <a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
            <div class="sidebar-brand-icon rotate-n-15">
                <i class="fas fa-laugh-wink"></i>
            </div>
            <div class="sidebar-brand-text mx-3"> Smart Health</div>
        </a>
        <hr class="sidebar-divider my-0">
        <li class="nav-item active">
            <a class="nav-link" href="#!patient">
                <i class="fas fa-fw fa-tachometer-alt"></i>
                <span>{{bar_patient_page}}</span></a>
        </li>
        <li class="nav-item active">
            <a class="nav-link" href="#!doctor">
                <i class="fas fa-fw fa-tachometer-alt"></i>
                <span>{{bar_doctor_page}}</span></a>
        </li>
    </ul>
    <div id="content-wrapper" class="d-flex flex-column">
        <div id="content">
            <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
                <ul class="navbar-nav ml-auto">
                    <div class="topbar-divider d-none d-sm-block"></div>
                    <li class="nav-item dropdown no-arrow">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="mr-2 d-none d-lg-inline text-gray-600 small">{{doctor_name}}</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="container-fluid">
                <div ng-view></div>
            </div>
        </div>
        <footer class="sticky-footer bg-white">
            <div class="container my-auto">
                <div class="copyright text-center my-auto">
                    <span>{{footer}}</span>
                </div>
            </div>
        </footer>
    </div>
</div>
</body>
</html>
